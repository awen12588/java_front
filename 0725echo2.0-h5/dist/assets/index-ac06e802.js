import{an as l,r as a,c as e,N as u,A as n,_ as o,s as i,o as v,a as s,j as c,u as t,k as d,q as r,C as m,t as p,y as f,l as h,w as _,F as b,I as g,p as y,$ as C,a0 as k}from"./vendor-a95f68e4.js";import{_ as w,r as P,aP as I,f as U,aQ as x,R as E,x as L,b as A,c as N,e as j,k as V,aR as F}from"./index-e83e29a3.js";import{u as S}from"./useFreeze-08cc92b1.js";import{A as z}from"./applyAmount-aff8a3b1.js";const Q={class:"content"},R={class:"from"},q=["placeholder"],D=(l=>(C("data-v-11b3b0e7"),l=l(),k(),l))((()=>d("span",null,"|",-1))),T={class:"svgImg"},$={class:"exchange_btn"},B={class:"to"},G=["placeholder"],H={class:"svgImg"},J={class:"rate ff-num"},K={class:"btn"},M={class:"coinList"},O=["onClick"],W={class:"svgImg"},X=w({__name:"index",setup(C){const{_isFreeze:k}=S(),{_toast:w}=P(),X=I(),Y=U();Y.getUserInfo();const{asset:Z}=l(Y),{swapCoinList:ll}=l(X),al=a(!0),el=a([]),ul=a([]),nl=a({}),ol=a({}),il=a(0),vl=a(0),sl=e((()=>{let l="";return Z.value.forEach(((a,e)=>{a.symbol==nl.value.coin&&1==a.type&&(l=a.availableAmount)})),l})),cl=a(0);u([il],(([l],[a])=>{al.value?(el.value.forEach(((a,e)=>{a.coin==l&&(nl.value=a)})),ul.value=ll.value.filter(((l,a)=>l.coin!=nl.value.coin)),l==vl.value&&(ol.value=ll.value.filter(((l,a)=>l.coin!=nl.value.coin))[0],vl.value=ol.value.coin)):el.value.forEach(((a,e)=>{a.coin==l&&(nl.value=a)}))})),u([vl],(([l],[a])=>{al.value?ul.value.forEach(((a,e)=>{a.coin==l&&(ol.value=a)})):(ul.value.forEach(((a,e)=>{a.coin==l&&(ol.value=a)})),el.value=ll.value.filter(((l,a)=>l.coin!=ol.value.coin)),l==vl.value&&(nl.value=ll.value.filter(((l,a)=>l.coin!=ol.value.coin))[0],il.value=ol.value.coin))})),u([nl,ol],((l,a)=>{var e,u,n,o;n=null==(e=l[0])?void 0:e.coin,o=null==(u=l[1])?void 0:u.coin,n=ml(n),o=ml(o),F(n,o).then((l=>{if("200"==l.code){let a=l.data["".concat(n)],e=l.data["".concat(o)];null==a&&(a=1),null==e&&(e=1),cl.value=V(a/e,8)}}))}),{deep:!0});const tl=a(!1),dl=a({}),rl=a("from"),ml=l=>l,pl=a(""),fl=a();u([pl,cl],(()=>{fl.value=V(pl.value*cl.value,8)})),n((()=>{(async()=>{var l,a,e,u;await X.getSwapCoinList();let n=[];Z.value.forEach(((l,a)=>{var e;let u={};"1"==l.type&&(u.id,u.amount=l.availableAmount,"usdt"==l.symbol&&(u.coin="usdt",u.icon="usdt",n.unshift(u)),"usdt"!=l.symbol&&(u.coin=null==(e=l.symbol)?void 0:e.replace("usdt","").trim(),u.icon=l.loge,n.push(u)))})),ll.value.forEach(((l,a)=>{n.forEach(((a,e)=>{a.coin==l.coin&&(l.amount=a.amount)}))})),el.value=n,["gmtoin2"].includes(__config._APP_ENV)?nl.value=n.find(((l,a)=>"btc"===l.coin)):nl.value=n[0],il.value=null==(l=nl.value)?void 0:l.coin,ul.value=null==(a=ll.value)?void 0:a.filter(((l,a)=>{var e;return l.coin!=(null==(e=nl.value)?void 0:e.coin)})),ol.value=null==(e=ll.value)?void 0:e.filter(((l,a)=>{var e;return l.coin!=(null==(e=nl.value)?void 0:e.coin)}))[0],vl.value=null==(u=ol.value)?void 0:u.coin})()}));const hl=l=>{"from"==l?dl.value=el.value:"to"==l&&(dl.value=ul.value),rl.value=l,tl.value=!0},_l=o.debounce((()=>{var l,a;if(pl.value<=0)return void w("swap_minNum");if(pl.value>sl.value)return void w("swap_maxNum");let e={fromSymbol:ml(null==(l=nl.value)?void 0:l.coin),toSymbol:ml(null==(a=ol.value)?void 0:a.coin),total:pl.value};x(e).then((l=>{"200"==l.code?(w("swap_success",["aams"]),setTimeout((()=>{Y.getUserInfo()}),1e3)):i(l.msg)}))}),500),bl=()=>{E.includes(__config._APP_ENV)?k(E)&&_l():_l()};return(l,a)=>{var e,u,n,o,i,C,k,w,P,I,U,x,E,V,F,S;const X=L,Y=A,Z=N,ll=g;return v(),s(b,null,[c(X,{currentName:t(j)("swap")},null,8,["currentName"]),c(z,{amount:sl.value||0,coin:null==(u=null==(e=nl.value)?void 0:e.coin)?void 0:u.toLocaleUpperCase()},null,8,["amount","coin"]),d("div",Q,[d("div",R,[r(d("input",{type:"number","onUpdate:modelValue":a[0]||(a[0]=l=>pl.value=l),placeholder:t(j)("swap_input"),class:"ff-num"},null,8,q),[[m,pl.value]]),d("div",null,[d("div",{class:"left",onClick:a[1]||(a[1]=l=>{var a;return pl.value=(null==(a=nl.value)?void 0:a.amount)||"0"})},p(t(j)("swap_all")),1),D,d("div",{class:"right",onClick:a[2]||(a[2]=l=>hl("from"))},[f(p(null==(o=null==(n=nl.value)?void 0:n.coin)?void 0:o.toLocaleUpperCase())+" ",1),d("div",T,[(null==(C=null==(i=nl.value)?void 0:i.icon)?void 0:C.length)>10?(v(),h(Y,{key:0,filePath:null==(k=nl.value)?void 0:k.icon,alt:"",class:"iconImg"},null,8,["filePath"])):(v(),h(Z,{key:1,name:null==(w=nl.value)?void 0:w.icon,class:"icon"},null,8,["name"]))])])])]),d("div",$,[c(Z,{name:"duihuan40x40",class:"dui",onClick:a[3]||(a[3]=l=>(()=>{al.value=!al.value;let l=el.value;el.value=ul.value,ul.value=l;let a=nl.value;nl.value=ol.value,ol.value=a})())})]),d("div",B,[r(d("input",{type:"number",disabled:"",class:"ff-num","onUpdate:modelValue":a[4]||(a[4]=l=>fl.value=l),placeholder:t(j)("swap_number")},null,8,G),[[m,fl.value]]),d("div",null,[d("div",{class:"right",onClick:a[5]||(a[5]=l=>hl("to"))},[f(p(null==(I=null==(P=ol.value)?void 0:P.coin)?void 0:I.toLocaleUpperCase())+" ",1),d("div",H,[(null==(x=null==(U=ol.value)?void 0:U.icon)?void 0:x.length)>10?(v(),h(Y,{key:0,filePath:null==(E=ol.value)?void 0:E.icon,class:"iconImg"},null,8,["filePath"])):(v(),h(Z,{key:1,name:null==(V=ol.value)?void 0:V.icon,class:"icon"},null,8,["name"]))])])])]),d("div",J,[d("p",null,p(t(j)("swap_rateDay"))+"：",1),f(" 1 "),d("span",null,p(null==(F=nl.value.coin)?void 0:F.toLocaleUpperCase()),1),f(" ≈ "),d("span",null,p(cl.value),1),d("span",null,p(null==(S=ol.value.coin)?void 0:S.toLocaleUpperCase()),1)])]),d("div",K,[d("p",{onClick:bl},p(t(j)("btnConfirm",["bitmake"])),1)]),c(ll,{show:tl.value,"onUpdate:show":a[6]||(a[6]=l=>tl.value=l),title:"",id:"sheetPopup",style:{"max-width":"var(--ex-max-width)",left:"50%",translate:"-50%"}},{default:_((()=>[d("div",M,[(v(!0),s(b,null,y(dl.value,((l,a)=>{var e,u;return v(),s("div",{key:l.id,class:"coinItem",onClick:a=>(l=>{tl.value=!1,"from"==rl.value?il.value=l.coin:"to"==rl.value&&(vl.value=l.coin)})(l)},[d("div",W,[(null==(e=null==l?void 0:l.icon)?void 0:e.length)>10?(v(),h(Y,{key:0,filePath:l.icon,alt:"",class:"iconImg"},null,8,["filePath"])):(v(),h(Z,{key:1,name:l.icon,class:"icon"},null,8,["name"]))]),d("div",null,[d("p",null,p(null==(u=l.coin)?void 0:u.toLocaleUpperCase()),1)])],8,O)})),128))])])),_:1},8,["show"])],64)}}},[["__scopeId","data-v-11b3b0e7"]]);export{X as default};
